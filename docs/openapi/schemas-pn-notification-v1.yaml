components:
  schemas:

    ############################################################################################
    ###                           IDENTIFICATIVI DELLE NOTIFICHE                             ###
    ############################################################################################
    
    IUN:
      description: Identificativo Univoco Notifica
      type: string

    ############################################################################################
    ###                                 DTO DELLE NOTIFICHE                                  ###
    ############################################################################################
    
    NewNotificationRequest:
      description: I campi utilizzati per la creazione di una nuova Notifica.
      type: object
      required:
        - paNotificationId
        - subject
        - recipients
        - documents
        - physicalCommunicationType
      properties:
        paNotificationId:
          description: >-
            Numero di protocollo che la PA mittente assegna alla notifica stessa
          type: string
        subject:
          type: string
          description: titolo della notifica
        abstract:
          type: string
          description: descrizione sintetica della notifica
        recipients:
          type: array
          description: Informazioni sui destinatari
          items:
            $ref: "#/components/schemas/NotificationRecipient"
        documents:
          type: array
          description: Documenti notificati
          items:
            $ref: "#/components/schemas/NotificationDocument"      
        cancelledIun:
          type: string
          description: IUN della notifica rettificata da questa notifica
        physicalCommunicationType:
          type: string
          description: Tipologia comunicazione fisica
          enum:
          - SIMPLE_REGISTERED_LETTER
          - REGISTERED_LETTER_890
        senderDenomination:
          description: Denominazione dell'ente mittente
          type: string
        senderTaxId:
          description: Codice Fiscale dell'ente mittente
          type: string
        group:
          type: string
          description: Gruppo di utenti dell'ente mittente che può visualizzare la notifica
    
    SentNotification:
      description: >-
        Le informazioni riguardanti una richiesta di notifica accettata
      allOf: 
        - $ref: '#/components/schemas/NewNotificationRequest'
        - type: object
          required:
            - iun
            - sentAt
          properties:
            senderPaId:
              type: string
              description: Identificativo IPA della PA mittente che ha eseguito l'onborading su SelfCare.
            iun:
              type: string
              description: L'Identificativo Univoco Notifica assegnato da PN
            sentAt:
              type: string
              description: Momento di ricezione della notifica da parte di PN
              format: date-time
            cancelledByIun:
              type: string
              description: IUN della notifica che ha rettificato questa notifica


    ############################################################################################
    ###                                ELEMENTI DI DETTAGLIO                                 ###
    ############################################################################################
    
    NotificationRecipient:
      description: Informazioni sui destinatari
      required:
      - denomination
      - recipientType
      - taxId
      type: object
      properties:
        recipientType:
          type: string
          description: 'Tipologia di destinatario: Persona Fisica (PF) o Persona Giuridica
            (PG)'
          enum:
          - PF
          - PG
        taxId:
          type: string
          description: Codice Fiscale del destinatario
        denomination:
          type: string
          description: Nome e cognome / ragione sociale
        digitalDomicile:
           $ref: "#/components/schemas/NotificationDigitalAddress"
        physicalAddress:
          $ref: "#/components/schemas/NotificationPhysicalAddress"
        payment:
          $ref: "#/components/schemas/NotificationPaymentInfo"

    NotificationAttachment:
      description: >-
        Un allegato della notifica utile per il pagamento
      type: object
      required:
        - digests
        - contentType
        - ref
      properties:
        digests:
          $ref: "#/components/schemas/NotificationAttachmentDigests"
        contentType:
          type: string
          description: tipo di contenuto dell'allegato, supportato application/pdf
        ref:
          $ref: "#/components/schemas/NotificationAttachmentBodyRef"

    NotificationDocument:
      description: >-
        Un documento da notifcare
      allOf: 
        - $ref: "#/components/schemas/NotificationAttachment"
        - type: object
          properties:
            title:
              type: string
              description: Titolo del documento allegato

    NotificationAttachmentDigests:
      description: Codici per la verifica del corretto caricamento di un allegato
      type: object
      required:
        - sha256
      properties:
        sha256:
          type: string
          description: Digest "sha256" della codifica binaria dell'allegato
    
    NotificationAttachmentBodyRef:
      description: Riferimento all'allegato precaricato
      required:
        - key
        - versionToken
      type: object
      properties:
        key:
          type: string
          description: Chiave in cui è stato salvato l'allegato
        versionToken:
          type: string
          description: Token per recuperare l'esatta istanza dell'allegato


    NotificationPaymentInfo:
      title: Informazioni per effettuare il pagamento
      description: >-
       Informazioni utili per effettuare il pagamento di una notifica, sono associate al 
       destinatario perché legate alle spese di notifica. <br/>
         - _notificationFeePolicy_: indica se il pagamento delle spese di notifica è forfettario o 
           calcolato puntualmente. <br/>
         - _noticeCode_: "codice avviso pagoPA" di pagamento del sistema pagoPA, usato per pagamento online.<br/>
         - _creditorTaxId_: codice fiscale dell'ente a cui fa riferimento il "codice avviso pagoPA". <br/>
         - _pagoPaForm_: riferimento al PDF contenete il bollettino pagoPA<br/>
         - _f24flatRate_: riferimento al PDF contenete l'F24 con spese di notifica forfettarie<br/>
         - _f24digital_: riferimento al PDF contenete l'F24 con spese di notifica digitale<br/>
         - _f24digitalWithRs_: riferimento al PDF contenete l'F24 con spese di notifica digitale 
           fallita a cui è seguita una raccomandata semplice<br/>
         - _f24analogRaccSingle_: riferimento al PDF contenete l'F24 con spese di notifica 
           analogica tramite __una__ Raccomandata A/R o Raccomandata a norma di legge 890/82<br/>
         - _f24analogRaccDouble_: riferimento al PDF contenete l'F24 con spese di notifica 
           analogica tramite __due__ Raccomandate A/R o Raccomandate a norma di legge 890/82 <br/>
         - _f24analogRiSingle_: riferimento al PDF contenete l'F24 con spese di notifica 
           analogica tramite __una__ Raccomandata Internazionale<br/>
         - _f24analogRiDouble_: riferimento al PDF contenete l'F24 con spese di notifica 
           analogica tramite __due__ Raccomandata Internazionali <br/>
      type: object
      required:
        - notificationFeePolicy
        - noticeNumber
        - creditorTaxId
        - pagoPaForm
      properties:
        notificationFeePolicy:
          type: string
          description: >-
            Politica di addebitamento dei costi di notifica. <br/>
            - _FLAT_RATE_: costo forfettario fisso. <br/>
            - _DELIVERY_MODE_: costo calcolato in base all'effettivo percorso di notifica. <br/>
          enum:
          - FLAT_RATE
          - DELIVERY_MODE
        noticeCode:
          type: string
          description: Numero Avviso di pagamento del sistema pagoPA, usato per pagamento online
        creditorTaxId:
          type: string
          description: Codice fiscale dell'ente a cui fa riferimento il "numero avviso".
        pagoPaForm:
          $ref: "#/components/schemas/NotificationAttachment"
        f24flatRate:
          $ref: "#/components/schemas/NotificationAttachment"
        f24digital:
          $ref: "#/components/schemas/NotificationAttachment"
        f24digitalWithRs:
          $ref: "#/components/schemas/NotificationAttachment"
        f24analogRaccSingle:
          $ref: "#/components/schemas/NotificationAttachment"
        f24analogRaccDouble:
          $ref: "#/components/schemas/NotificationAttachment"
        f24analogRiSingle:
          $ref: "#/components/schemas/NotificationAttachment"
        f24analogRiDouble:
          $ref: "#/components/schemas/NotificationAttachment"


    ############################################################################################
    ### ???????????? RIPETIZIONE DI ELEMENTI ESTERNI, PER NON ACCOPPIARE TROPPO              ###
    ############################################################################################
    
    NotificationDigitalAddress:
      description: Indirizzo di invio della notifica
      required:
      - address
      - type
      type: object
      properties:
        type:
          type: string
          description: tipo di indirizzo PEC, REM, SERCQ, ...
          enum:
          - PEC
        address:
          type: string
          description: account@domain
    
    NotificationPhysicalAddress:
      description: Indirizzo fisico scoperto durante fase di consegna
      type: object
      required:
        - address
        - municipality
        - zip
      properties:
        at:
          type: string
          description: Campo "presso" dell'indirizzo
        address:
          type: string
          description: Indirizzo del domicilio fisico
        addressDetails:
          type: string
          description: Seconda riga dell'indirizzo fisico
        zip:
          type: string
          description: Codice di avviamento postale
        municipality:
          type: string
          description: Comune in cui l'indirizzo si trova
        municipalityDetails:
          type: string
          description: Frazione o località
        province:
          type: string
          description: Provincia in cui si trova l'indirizzo
        foreignState:
          type: string
          description: Denominazione paese estero
    
    
    ############################################################################################
    ###                             RISULTATO RICERCA NOTIFICHE                              ###
    ############################################################################################
    
    ResultPaginationDtoNotificationSearchRow:
      type: object
      properties:
        result:
          type: array
          items:
            $ref: '#/components/schemas/NotificationSearchRow'
        moreResult:
          type: boolean
        nextPagesKey:
          type: array
          items:
            type: string

    NotificationSearchRow:
      type: object
      properties:
        iun:
          type: string
          description: Identificativo Univoco Notifica
        paNotificationId:
          type: string
          description: Numero protocollo associato alla notifica da parte della PA
        sender:
          type: string
          description: Denominazione della PA che ha inviato l'atto.
        sentAt:
          type: string
          description: Data spedizione notifica
          format: date-time
        subject:
          type: string
          description: Oggetto della notifica
        notificationStatus:
          $ref: '#/components/schemas/NotificationStatus'
        recipients:
          description: Elenco delle denominazioni dei destinatari della notifica
          type: array
          items:
            type: string
    
    NotificationStatus:
      $ref: './remote-refs.yaml#/components/schemas/NotificationStatus'


    ############################################################################################
    ###                                  DOWNLOAD ALLEGATI                                   ###
    ############################################################################################
    
    NotificationAttachmentDownloadMetadataResponse:
      title: Url e metadati per il download di un allegato di una notifica
      description: >-
        I due campi più importanti sono __url__ e __retryAfter__. <br/>
          - __url__ è presente se il file è pronto per essere scaricato ed indica l'url a cui fare GET.
          - __retryAfter__ indica che il file non è stato archiviato e bisognerà aspettare un numero di
            secondi non inferiore a quanto indicato dal campo _retryAfter_. <br/>
      type: object
      required:
        - filename
        - contentType
        - contentLength
        - sha256
      properties:
        filename:
          type: string
        contentType:
          type: string
          example: 'application/pdf'
        contentLength:
          type: number
          example: 54092
          description: dmensione, in byte, del contenuto.
        sha256:
          type: string
          description: >- 
            SHA256 del contenuto del file. Il tipo di checksum cambia a seconda del 
            documentType.
        url:
          type: string
          description: >-
            URL preautorizzato a cui effettuare una richiesta GET per ottenere il 
            contenuto del documento. Presente solo se il documento è pronto per il download.
        retryAfter:
          type: number
          description: >-
            Stima del numero di secondi da aspettare prima che il contenuto del 
            documento sia scaricabile.

        
    

      
      
      